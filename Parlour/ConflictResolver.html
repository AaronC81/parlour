<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Parlour::ConflictResolver
  
    &mdash; Documentation by YARD 0.9.20
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Parlour::ConflictResolver";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Parlour.html" title="Parlour (module)">Parlour</a></span></span>
     &raquo; 
    <span class="title">ConflictResolver</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Parlour::ConflictResolver
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Parlour::ConflictResolver</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>T::Sig</dd>
  </dl>
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/parlour/conflict_resolver.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Responsible for resolving conflicts (that is, multiple definitions with the same name) between objects defined in the same namespace.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resolve_conflicts-instance_method" title="#resolve_conflicts (instance method)">#<strong>resolve_conflicts</strong>(namespace) {|message, candidates| ... } &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given a namespace, attempts to automatically resolve conflicts in the namespace&#39;s definitions.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="resolve_conflicts-instance_method">
  
    #<strong>resolve_conflicts</strong>(namespace) {|message, candidates| ... } &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Given a namespace, attempts to automatically resolve conflicts in the namespace&#39;s definitions. (A conflict occurs when multiple objects share the same name.)</p>

<p>All children of the given namespace which are also namespaces are processed recursively, so passing <span class='object_link'><a href="RbiGenerator.html#root-instance_method" title="Parlour::RbiGenerator#root (method)">RbiGenerator#root</a></span> will eliminate all conflicts in the entire object tree.</p>

<p>If automatic resolution is not possible, the block passed to this method is invoked and passed two arguments: a message on what the conflict is, and an array of candidate objects. The block should return one of these candidate objects, which will be kept, and all other definitions are deleted. Alternatively, the block may return nil, which will delete all definitions. The block may be invoked many times from one call to  <span class='object_link'><a href="#resolve_conflicts-instance_method" title="Parlour::ConflictResolver#resolve_conflicts (method)">#resolve_conflicts</a></span>, one for each unresolvable conflict.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>namespace</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RbiGenerator/Namespace.html" title="Parlour::RbiGenerator::Namespace (class)">RbiGenerator::Namespace</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The starting namespace to resolve conflicts in.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>message</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A descriptional message on what the conflict is.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>candidates</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="RbiGenerator/RbiObject.html" title="Parlour::RbiGenerator::RbiObject (class)">RbiGenerator::RbiObject</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The objects for which there is a conflict.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RbiGenerator/RbiObject.html" title="Parlour::RbiGenerator::RbiObject (class)">RbiGenerator::RbiObject</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>One of the <code>candidates</code>, which will be kept, or nil to keep none of them.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/parlour/conflict_resolver.rb', line 41</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve_conflicts'>resolve_conflicts</span><span class='lparen'>(</span><span class='id identifier rubyid_namespace'>namespace</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_resolver'>resolver</span><span class='rparen'>)</span>
  <span class='comment'># Check for multiple definitions with the same name
</span>  <span class='id identifier rubyid_grouped_by_name_children'>grouped_by_name_children</span> <span class='op'>=</span> <span class='id identifier rubyid_namespace'>namespace</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:name</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_grouped_by_name_children'>grouped_by_name_children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_children'>children</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='comment'># We found a conflict!
</span>      <span class='comment'># Start by removing all the conflicting items
</span>      <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
        <span class='id identifier rubyid_namespace'>namespace</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># We can only try to resolve automatically if they&#39;re all the same 
</span>      <span class='comment'># type of object, so check that first
</span>      <span class='id identifier rubyid_children_type'>children_type</span> <span class='op'>=</span> <span class='id identifier rubyid_single_type_of_array'>single_type_of_array</span><span class='lparen'>(</span><span class='id identifier rubyid_children'>children</span><span class='rparen'>)</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_children_type'>children_type</span>
        <span class='comment'># The types aren&#39;t the same, so ask the resovler what to do, and
</span>        <span class='comment'># insert that (if not nil)
</span>        <span class='id identifier rubyid_choice'>choice</span> <span class='op'>=</span> <span class='id identifier rubyid_resolver'>resolver</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Different kinds of definition for the same name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_children'>children</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_namespace'>namespace</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_choice'>choice</span> <span class='kw'>if</span> <span class='id identifier rubyid_choice'>choice</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='comment'># Can the children merge themselves automatically? If so, let them
</span>      <span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='id identifier rubyid_children'>children</span>
      <span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_must'>must</span><span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_must'>must</span><span class='lparen'>(</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_must'>must</span><span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_mergeable?'>mergeable?</span><span class='lparen'>(</span><span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_must'>must</span><span class='lparen'>(</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_merge_into_self'>merge_into_self</span><span class='lparen'>(</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_namespace'>namespace</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_first'>first</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='comment'># I give up! Let it be resolved manually somehow
</span>      <span class='id identifier rubyid_choice'>choice</span> <span class='op'>=</span> <span class='id identifier rubyid_resolver'>resolver</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t automatically resolve</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_children'>children</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_namespace'>namespace</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_choice'>choice</span> <span class='kw'>if</span> <span class='id identifier rubyid_choice'>choice</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Recurse to child namespaces
</span>  <span class='id identifier rubyid_namespace'>namespace</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
    <span class='id identifier rubyid_resolve_conflicts'>resolve_conflicts</span><span class='lparen'>(</span><span class='id identifier rubyid_child'>child</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_resolver'>resolver</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="RbiGenerator.html" title="Parlour::RbiGenerator (class)">RbiGenerator</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="RbiGenerator/Namespace.html" title="Parlour::RbiGenerator::Namespace (class)">Namespace</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_child'>child</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Jul 20 20:27:05 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.20 (ruby-2.6.3).
</div>

    </div>
  </body>
</html>